"use strict";(self.webpackChunkthecapitaltree=self.webpackChunkthecapitaltree||[]).push([[471],{2471:(e,a,s)=>{s.r(a),s.d(a,{default:()=>d});var t=s(5043),n=s(3930),r=s(579);const i="http://43.204.120.102:3308",l="authToken",o=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(a){return console.error("Error formatting date:",e,a),"Invalid Date"}},c=e=>{let{transactions:a,periodTitle:s,isLoading:t,showUserName:n=!1}=e;return t?(0,r.jsxs)("p",{className:"loading-message",children:["Loading ",s," transactions..."]}):"string"===typeof a?(0,r.jsx)("p",{className:"info-message",children:a}):Array.isArray(a)&&0!==a.length?(0,r.jsx)("div",{className:"transaction-table-container",children:(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"ID"}),n&&(0,r.jsx)("th",{children:"User Name"})," ",(0,r.jsx)("th",{children:"Plan Name"}),(0,r.jsx)("th",{children:"Amount"}),(0,r.jsx)("th",{children:"Status"}),(0,r.jsx)("th",{children:"Date"}),!n&&(0,r.jsx)("th",{children:"User ID"})," "]})}),(0,r.jsx)("tbody",{children:a.map((e=>{var a,s,t,i;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{"data-label":"ID",children:e.id}),n&&(0,r.jsx)("td",{"data-label":"User Name",children:(null===(a=e.User)||void 0===a?void 0:a.name)||"N/A"}),(0,r.jsx)("td",{"data-label":"Plan Name",children:(null===(s=e.Plan)||void 0===s?void 0:s.name)||"N/A"}),(0,r.jsxs)("td",{"data-label":"Amount",children:["$",(null===(t=e.amount)||void 0===t?void 0:t.toFixed(2))||"0.00"]}),(0,r.jsx)("td",{"data-label":"Status",children:(0,r.jsx)("span",{className:`status-badge status-${(null===(i=e.status)||void 0===i?void 0:i.toLowerCase())||"unknown"}`,children:e.status||"N/A"})}),(0,r.jsx)("td",{"data-label":"Date",children:o(e.createdAt)}),!n&&(0,r.jsx)("td",{"data-label":"User ID",children:e.userId})]},e.id)}))})]})}):(0,r.jsxs)("p",{className:"info-message",children:["No ",s.toLowerCase()," transactions found."]})},d=()=>{const[e,a]=(0,t.useState)({daily:null,weekly:null,monthly:null,yearly:null,all:null}),[s,o]=(0,t.useState)({daily:!0,weekly:!0,monthly:!0,yearly:!0,all:!0}),[d,h]=(0,t.useState)("daily"),[m,u]=(0,t.useState)(null);const y=(0,t.useCallback)((async(e,s)=>{if(!s)return a((a=>({...a,[e]:"Authentication required."}))),void o((a=>({...a,[e]:!1})));o((a=>({...a,[e]:!0}))),a((a=>({...a,[e]:null})));const t=`${i}/api/transactions/user/1?period=${e}`;try{const r=await fetch(t,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(401===r.status||403===r.status)return u("Authentication failed or session expired. Please log in again."),localStorage.removeItem(l),void a((a=>({...a,[e]:"Access Denied. Please re-login."})));const i=await r.text();let o;try{o=JSON.parse(i)}catch(n){throw console.error(`Error parsing JSON for ${e} from ${t}. Status: ${r.status}. Response:`,i),new Error(`Server returned non-JSON data. Status: ${r.status}.`)}if(404===r.status&&o.message)a((a=>({...a,[e]:o.message})));else{if(!r.ok)throw new Error(o.message||`Failed to fetch ${e} transactions (Status: ${r.status})`);a((a=>({...a,[e]:o})))}}catch(r){a((a=>({...a,[e]:`Error loading ${e} data: ${r.message}`})))}finally{o((a=>({...a,[e]:!1})))}}),[i]),g=(0,t.useCallback)((async e=>{const s="all";if(!e)return a((e=>({...e,[s]:"Authentication required."}))),void o((e=>({...e,[s]:!1})));o((e=>({...e,[s]:!0}))),a((e=>({...e,[s]:null})));const t=`${i}/api/transactions`;try{const r=await fetch(t,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(401===r.status||403===r.status)return u("Authentication failed or session expired. Please log in again."),localStorage.removeItem(l),void a((e=>({...e,[s]:"Access Denied. Please re-login."})));const i=await r.text();let o;try{o=JSON.parse(i)}catch(n){throw console.error(`Error parsing JSON for ALL transactions from ${t}. Status: ${r.status}. Response:`,i),new Error(`Server returned non-JSON data. Status: ${r.status}.`)}if(!r.ok)throw new Error(o.message||`Failed to fetch all transactions (Status: ${r.status})`);Array.isArray(o)&&0===o.length?a((e=>({...e,[s]:"No transactions found in the system."}))):a((e=>({...e,[s]:o})))}catch(r){console.error("Error during fetch or processing for ALL transactions:",r),a((e=>({...e,[s]:`Error loading all transactions: ${r.message}`})))}finally{o((e=>({...e,[s]:!1})))}}),[i]);(0,t.useEffect)((()=>{const e=localStorage.getItem(l);if(!e){u("Authentication token not found. Please log in to view transactions.");const e={daily:!1,weekly:!1,monthly:!1,yearly:!1,all:!1},s={};return Object.keys(e).forEach((e=>{s[e]="Authentication required."})),o(e),void a(s)}u(null);["daily","weekly","monthly","yearly"].forEach((a=>{y(a,e)})),g(e)}),[y,g,i]);return(0,r.jsxs)("div",{className:"dashboard-transaction-page",children:[(0,r.jsx)(n.A,{}),(0,r.jsxs)("div",{className:"main-content-area",children:[(0,r.jsx)("header",{className:"page-header",children:(0,r.jsx)("h1",{children:"Transaction History"})}),(0,r.jsxs)("section",{className:"transactions-section",children:[(0,r.jsx)("div",{className:"tabs-navigation",children:[{key:"all",label:"All Transactions"},{key:"daily",label:"Daily"},{key:"weekly",label:"Weekly"},{key:"monthly",label:"Monthly"},{key:"yearly",label:"Yearly"}].map((e=>(0,r.jsx)("button",{onClick:()=>h(e.key),className:"tab-button "+(d===e.key?"active":""),disabled:s[e.key]&&d!==e.key,children:e.label},e.key)))}),(0,r.jsx)("div",{className:"tab-content-area",children:(()=>{if(m)return(0,r.jsx)("p",{className:"error-message global-error-message",children:m});const a=d.charAt(0).toUpperCase()+d.slice(1),t="all"===d;return(0,r.jsx)(c,{transactions:e[d],periodTitle:"all"===d?"All System Transactions":`${a} (User ID: 1)`,isLoading:s[d],showUserName:t})})()})]})]})]})}},3930:(e,a,s)=>{s.d(a,{A:()=>l});s(5043);var t=s(3216),n=s(5475),r=s(7956),i=s(579);const l=e=>{let{onLogout:a,isOpen:s,onClose:l}=e;const o=(0,t.Zp)(),c=()=>{"function"===typeof a?a():(localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),o("/login"))},d=()=>{l&&window.innerWidth<=768&&l()};return(0,i.jsxs)(i.Fragment,{children:[s&&(0,i.jsx)("div",{className:"admin-sidebar__overlay",onClick:e=>{e.target.classList.contains("admin-sidebar__overlay")&&l()},"aria-hidden":"true"}),(0,i.jsxs)("aside",{className:"admin-sidebar "+(s?"open":""),children:[(0,i.jsxs)("div",{className:"admin-sidebar__logo-section",children:[(0,i.jsx)("img",{src:r,alt:"logo",height:"50px",width:"50px"}),(0,i.jsx)("h2",{className:"admin-sidebar__title",children:"Admin Dashboard"})]}),(0,i.jsxs)("ul",{className:"admin-sidebar__menu",children:[(0,i.jsx)("li",{className:"admin-sidebar__menu-item",children:(0,i.jsx)(n.k2,{to:"/adminDashboard",end:!0,className:e=>{let{isActive:a}=e;return a?"active-link":""},onClick:d,children:"Invest Dashboard"})}),(0,i.jsx)("li",{className:"admin-sidebar__menu-item",children:(0,i.jsx)(n.k2,{to:"/adminDashboard/userManagement",className:e=>{let{isActive:a}=e;return a?"active-link":""},onClick:d,children:"User Management"})}),(0,i.jsx)("li",{className:"admin-sidebar__menu-item",children:(0,i.jsx)(n.k2,{to:"/adminDashboard/manageBlog",className:e=>{let{isActive:a}=e;return a?"active-link":""},onClick:d,children:"Manage Blog"})}),(0,i.jsx)("li",{className:"admin-sidebar__menu-item",children:(0,i.jsx)(n.k2,{to:"/adminDashboard/transaction",className:e=>{let{isActive:a}=e;return a?"active-link":""},onClick:d,children:"Transactions"})}),(0,i.jsx)("li",{className:"admin-sidebar__menu-item",children:(0,i.jsx)(n.k2,{to:"/adminDashboard/withdrawals",className:e=>{let{isActive:a}=e;return a?"active-link":""},onClick:d,children:"Withdrawals"})}),(0,i.jsx)("li",{className:"admin-sidebar__menu-item",children:(0,i.jsx)(n.k2,{to:"/adminDashboard/adminPlans",className:e=>{let{isActive:a}=e;return a?"active-link":""},onClick:d,children:"Plans"})})]}),(0,i.jsx)("div",{className:"admin-sidebar__signout",onClick:c,style:{cursor:"pointer"},tabIndex:0,role:"button",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||c()},children:"Sign Out"})]})]})}},7956:(e,a,s)=>{e.exports=s.p+"static/media/logo3.53e806f77f8987aa2fc1.png"}}]);
//# sourceMappingURL=471.956b495f.chunk.js.map