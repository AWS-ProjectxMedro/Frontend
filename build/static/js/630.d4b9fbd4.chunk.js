"use strict";(self.webpackChunkthecapitaltree=self.webpackChunkthecapitaltree||[]).push([[630],{1630:(e,a,s)=>{s.r(a),s.d(a,{apiClient:()=>i,default:()=>o});var t=s(5043),n=s(6213),l=s(579);const i=n.A.create({baseURL:"http://43.204.120.102:3308/api"});i.interceptors.request.use((e=>{const a=localStorage.getItem("authToken");return a&&(e.headers.Authorization=`Bearer ${a}`),e}),(e=>Promise.reject(e)));const o=()=>{const[e,a]=(0,t.useState)([]),[s,n]=(0,t.useState)(!1),[o,r]=(0,t.useState)(null),[d,c]=(0,t.useState)(!1),[p,h]=(0,t.useState)(null),[u,m]=(0,t.useState)({name:"",description:"",price:""}),g=(0,t.useCallback)((async()=>{n(!0),r(null);if(!localStorage.getItem("authToken"))return r("Authorization token not found. Please ensure you are logged in."),n(!1),void a([]);try{const e=await i.get("/plans");a(e.data||[])}catch(s){let a="Failed to fetch plans.";var e;if(s.response)a=(null===(e=s.response.data)||void 0===e?void 0:e.message)||`Error ${s.response.status}: ${s.response.statusText}`,401!==s.response.status&&403!==s.response.status||(a+=" (Authorization failed. Your session might have expired or token is invalid. Please try logging in again.)");else a=s.request?"No response from server. Check network connection.":s.message;r(a),console.error("Failed to fetch plans:",s)}finally{n(!1)}}),[]);(0,t.useEffect)((()=>{g()}),[g]);const v=e=>{const{name:a,value:s}=e.target;m((e=>({...e,[a]:"price"===a?""===s?"":parseFloat(s)<0?"0":s:s})))},x=()=>{m({name:"",description:"",price:""}),h(null),c(!1),r(null)};return(0,l.jsxs)("div",{className:"admin-plans-page",children:[(0,l.jsxs)("div",{className:"page-header",children:[(0,l.jsx)("h1",{children:"Manage Investment Plans"}),(0,l.jsxs)("button",{onClick:()=>{localStorage.getItem("authToken")?(h(null),m({name:"",description:"",price:""}),c(!0)):r("Cannot add plan: Authorization token not found. Please log in.")},className:"btn btn-primary btn-add-plan",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",width:"20",height:"20",children:(0,l.jsx)("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})}),"Add New Plan"]})]}),o&&!d&&(0,l.jsx)("div",{className:"global-error-message",children:o}),s&&0===e.length&&!o&&(0,l.jsx)("div",{className:"loading-indicator",children:"Loading plans..."}),d&&(0,l.jsx)("div",{className:"modal-overlay","data-testid":"modal-overlay",onClick:x,children:(0,l.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("button",{className:"modal-close-button",onClick:x,children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",width:"24",height:"24",children:(0,l.jsx)("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})})}),(0,l.jsx)("h2",{children:p?"Edit Plan":"Create New Plan"}),o&&d&&(0,l.jsx)("p",{className:"form-error-message",children:o}),(0,l.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),r(null);if(!localStorage.getItem("authToken"))return r("Cannot save plan: Authorization token not found. Please log in."),void n(!1);const{name:a,description:s,price:t}=u;if(!a.trim()||""===t||parseFloat(t)<0)return void r("Plan Name and a valid Price (>= 0) are required.");n(!0);const l={name:a.trim(),description:s.trim(),price:parseFloat(t)};try{p&&p.id?await i.put(`/plans/${p.id}`,l):await i.post("/plans",l),x(),g()}catch(e){let a="Failed to save plan.";var o;if(e.response)a=(null===(o=e.response.data)||void 0===o?void 0:o.message)||`Error ${e.response.status}: ${e.response.statusText}`,401!==e.response.status&&403!==e.response.status||(a+=" (Authorization failed. Check token or permissions. You might need to log in again.)");else a=e.request?"No response from server while saving.":e.message;r(a),console.error("Failed to save plan:",e),n(!1)}},children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"name",children:"Plan Name"}),(0,l.jsx)("input",{type:"text",id:"name",name:"name",value:u.name,onChange:v,placeholder:"e.g., Growth Portfolio",required:!0})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"description",children:"Description (Optional)"}),(0,l.jsx)("textarea",{id:"description",name:"description",value:u.description,onChange:v,placeholder:"Briefly describe this plan...",rows:"4"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"price",children:"Price ($)"}),(0,l.jsx)("input",{type:"number",id:"price",name:"price",value:u.price,onChange:v,placeholder:"e.g., 99.99",required:!0,step:"0.01",min:"0"})]}),(0,l.jsxs)("div",{className:"form-actions",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:x,disabled:s,children:"Cancel"}),(0,l.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:s,children:s?"Saving...":p?"Update Plan":"Create Plan"})]})]})]})}),!d&&(0,l.jsxs)("div",{className:"plans-grid",children:[0===e.length&&!s&&(!o||o&&!o.toLowerCase().includes("token not found"))&&(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("p",{children:"No investment plans found."}),(0,l.jsx)("p",{children:'Click "Add New Plan" to get started!'})]}),e.map((e=>(0,l.jsxs)("div",{className:"plan-card",children:[(0,l.jsxs)("div",{className:"plan-card-content",children:[(0,l.jsxs)("div",{className:"plan-card-header",children:[(0,l.jsx)("h3",{children:e.name}),(0,l.jsxs)("span",{className:"plan-price",children:["$",parseFloat(e.price).toFixed(2)]})]}),(0,l.jsx)("p",{className:"plan-description",children:e.description||(0,l.jsx)("span",{className:"no-description",children:"No description provided."})}),(0,l.jsxs)("div",{className:"plan-meta",children:[(0,l.jsxs)("small",{children:["ID: ",e.id]}),(0,l.jsxs)("small",{children:["Created: ",new Date(e.createdAt).toLocaleDateString()]}),(0,l.jsxs)("small",{children:["Last Updated: ",new Date(e.updatedAt).toLocaleDateString()]})]})]}),(0,l.jsxs)("div",{className:"plan-card-actions",children:[(0,l.jsx)("button",{onClick:()=>(e=>{localStorage.getItem("authToken")?(h(e),m({name:e.name,description:e.description||"",price:e.price.toString()}),c(!0)):r("Cannot edit plan: Authorization token not found. Please log in.")})(e),className:"btn btn-icon btn-edit",title:"Edit Plan",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",width:"18",height:"18",children:(0,l.jsx)("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})}),(0,l.jsx)("button",{onClick:()=>(async e=>{if(localStorage.getItem("authToken")){if(window.confirm("Are you sure you want to delete this plan? This action cannot be undone.")){n(!0),r(null);try{await i.delete(`/plans/${e}`),g()}catch(s){let e="Failed to delete plan.";var a;s.response?(e=(null===(a=s.response.data)||void 0===a?void 0:a.message)||`Error ${s.response.status}: ${s.response.statusText}`,401!==s.response.status&&403!==s.response.status||(e+=" (Authorization failed. Check token or permissions. You might need to log in again.)")):e=s.request?"No response from server while deleting.":s.message,r(e),console.error("Failed to delete plan:",s),n(!1)}}}else r("Cannot delete plan: Authorization token not found. Please log in.")})(e.id),className:"btn btn-icon btn-delete",disabled:s,title:"Delete Plan",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",width:"18",height:"18",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.19-2.34.343a.75.75 0 00-.5.832l.995 6.967c.23.159.48.298.745.414V17a1 1 0 001 1h4a1 1 0 001-1v-4.745a5.38 5.38 0 00.745-.414l.995-6.967a.75.75 0 00-.5-.832c-.76-.153-1.545-.266-2.34-.343V3.75A2.75 2.75 0 008.75 1zM7.5 3.75c0-.69.56-1.25 1.25-1.25s1.25.56 1.25 1.25v.443c-.455.042-.914.101-1.37.174A4.34 4.34 0 007.5 4.193V3.75zM8.75 6a.75.75 0 00-.75.75v4.5a.75.75 0 001.5 0v-4.5A.75.75 0 008.75 6z",clipRule:"evenodd"})})})]})]},e.id)))]})]})}}}]);
//# sourceMappingURL=630.d4b9fbd4.chunk.js.map