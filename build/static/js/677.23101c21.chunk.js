"use strict";(self.webpackChunkthecapitaltree=self.webpackChunkthecapitaltree||[]).push([[677],{3677:(e,t,r)=>{r.r(t),r.d(t,{default:()=>N});var a=r(5043),n=r(6213),o=r(6931),i=r(6382),s=r(9324),l=r(5664),d=r(108),c=r(5748),u=r(7734),m=r(2185),h=r(6026),y=r(6150),p=r(168),f=r(3216),g=r(579);const x={dashboardUser:{display:"flex",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'},themeDark:{backgroundColor:"#161921",color:"#e0e0e0",minHeight:"100vh"},sidebar:{width:"240px",backgroundColor:"#1f232d",padding:"20px",display:"flex",flexDirection:"column",borderRight:"1px solid #333"},sidebarTitle:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"30px",color:"#fff"},sidebarNav:{flexGrow:1},sidebarLink:{display:"block",color:"#a0a8c2",textDecoration:"none",padding:"12px 0",fontSize:"1rem"},logoutButton:{width:"100%",padding:"12px",fontSize:"1rem",backgroundColor:"#e53935",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},dashboardMainContent:{flex:1,padding:"2rem"},dashboardContentHeader:{marginBottom:"2rem"},headerTitle:{fontSize:"2.5rem",fontWeight:"bold",margin:"0 0 10px 0",color:"#fff"},headerSubtitle:{fontSize:"1.1rem",color:"#a0a8c2",margin:0},headerStats:{marginTop:"1rem",display:"flex",gap:"2rem",color:"#a0a8c2"},dashboardGridCards:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem"},dashboardCard:{backgroundColor:"#1f232d",padding:"25px",borderRadius:"10px",color:"#e0e0e0",display:"flex",flexDirection:"column",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},cardHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},cardTitle:{margin:0,fontSize:"1.1rem",fontWeight:"600"},dataSource:{fontSize:"0.8rem",color:"#a0a8c2"},cardBody:{flexGrow:1,display:"flex",flexDirection:"column"},amount:{fontSize:"2.2rem",fontWeight:"bold",margin:"0 0 5px 0",color:"#fff"},change:{fontSize:"0.9rem",margin:0,color:"#00b929"},chartContainerLine:{flexGrow:1,minHeight:"120px",marginTop:"1rem"},chartNoData:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#a0a8c2"},transactionItem:{display:"flex",justifyContent:"space-between",padding:"8px 0",borderTop:"1px solid #333"},customTooltip:{backgroundColor:"rgba(31, 35, 45, 0.9)",border:"1px solid #444",padding:"10px",borderRadius:"5px",color:"#fff"}},v=e=>{let{setIsAuthenticated:t}=e;(0,f.Zp)()},b=n.A.create({baseURL:"http://43.204.120.102:3308",headers:{"Content-Type":"application/json"}});b.interceptors.request.use((e=>{const t=localStorage.getItem("authToken");return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e)));const j={staleTime:3e5,cacheTime:6e5,refetchOnWindowFocus:!1,refetchOnMount:!1,retry:1,retryDelay:1e3},k=a.memo((e=>{let{data:t,dataKey:r,stroke:a,name:n,yAxisFormatter:o}=e;return t&&0!==t.length?(0,g.jsx)(d.u,{width:"100%",height:"100%",children:(0,g.jsxs)(c.b,{data:t,margin:{top:20,right:20,left:-10,bottom:5},children:[(0,g.jsx)(u.d,{strokeDasharray:"3 3",stroke:"rgba(255, 255, 255, 0.08)",vertical:!1}),(0,g.jsx)(m.W,{dataKey:"investment"===n?"name":"year",tick:{fill:"#a0a8c2"},axisLine:!1,tickLine:!1}),(0,g.jsx)(h.h,{tick:{fill:"#a0a8c2"},axisLine:!1,tickLine:!1,tickFormatter:o}),(0,g.jsx)(y.m,{content:(0,g.jsx)(M,{}),cursor:{stroke:`rgba(${"#8a7cff"===a?"138, 124, 255":"0, 185, 41"}, 0.3)`,strokeWidth:2}}),(0,g.jsx)(p.N,{type:"monotone",dataKey:r,stroke:a,strokeWidth:3,dot:{r:4,strokeWidth:2,fill:"#fff"},activeDot:{r:8,stroke:a,fill:"#fff"}})]})}):(0,g.jsx)("div",{style:x.chartNoData,children:(0,g.jsx)("p",{children:"No data available"})})}));k.displayName="MemoizedLineChart";const I=a.memo((e=>{let{title:t,amount:r,isLoading:a,error:n,chart:o,cardStyle:s,dataSource:l,changeText:d}=e;return(0,g.jsxs)(i.A,{component:"article",style:{...x.dashboardCard,...s},children:[(0,g.jsxs)("div",{style:x.cardHeader,children:[(0,g.jsx)("h3",{style:x.cardTitle,children:t}),l&&(0,g.jsx)("span",{style:x.dataSource,children:l})]}),(0,g.jsxs)("div",{style:x.cardBody,children:[(0,g.jsx)("p",{style:x.amount,children:a?"Loading...":n?"Error":r||"\u20b90"}),d&&(0,g.jsx)("p",{style:x.change,children:d}),o&&(0,g.jsx)("div",{style:x.chartContainerLine,children:o})]})]})}));I.displayName="DashboardCard";const C=async()=>{try{return(await b.get("/api/users/total-investment")).data}catch(e){return console.error("Error fetching total investment:",e),{totalInvestment:0}}},S=async()=>{try{return(await b.get("/api/users/total-profit-loss")).data}catch(e){return console.error("Error fetching total profit:",e),{totalProfitOrLoss:0}}},L=async()=>{try{return(await b.get("/api/users/monthly-investment-data")).data}catch(e){return console.error("Error fetching monthly investment data:",e),{monthlyData:[]}}},D=async()=>{try{return(await b.get("/api/users/yearly-profit-data")).data}catch(e){return console.error("Error fetching yearly profit data:",e),{yearlyData:[]}}},w=async()=>{try{return(await b.get("/api/users/portfolio-performance")).data}catch(e){return console.error("Error fetching portfolio performance:",e),{performance:0,trend:"Stable"}}},T=async()=>{try{return(await b.get("/api/users/recent-transactions")).data}catch(e){return console.error("Error fetching recent transactions:",e),{transactions:[]}}},F=(e,t,r,a)=>{if(!e)return t.map((e=>({[a]:e,[r]:0})));const n=6===t.length?[.05,.15,.1,.25,.2,.25]:[.2,.4,.4];return t.map(((t,o)=>({[a]:t,[r]:Math.round(n[o%n.length]*e)})))},A=()=>{const[e,t]=a.useState({isAuthenticated:!1,currentUser:null,loading:!0});return a.useEffect((()=>{try{const e=localStorage.getItem("authToken"),r=localStorage.getItem("userData");if(e&&r){const a=(e=>{try{return JSON.parse(atob(e.split(".")[1]))}catch(t){return null}})(e);if(a&&1e3*a.exp>Date.now())return void t({isAuthenticated:!0,currentUser:JSON.parse(r),loading:!1})}t({isAuthenticated:!1,currentUser:null,loading:!1})}catch(e){t({isAuthenticated:!1,currentUser:null,loading:!1})}}),[]),e},M=a.memo((e=>{let{active:t,payload:r,label:a}=e;if(t&&null!==r&&void 0!==r&&r.length){const e=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0);return(0,g.jsxs)("div",{style:x.customTooltip,children:[(0,g.jsx)("p",{children:a}),(0,g.jsx)("p",{children:`${r[0].name}: ${e(r[0].value)}`})]})}return null}));M.displayName="CustomTooltip";const N=e=>{var t;let{setIsAuthenticated:r}=e;const{currentUser:n,isAuthenticated:d,loading:c}=A(),u=(0,f.Zp)(),m=(0,a.useRef)(!1),h=(0,a.useRef)(!1),y=(0,a.useCallback)((e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0)),[]),p=(0,a.useCallback)((e=>`\u20b9${Math.round(e/1e3)}k`),[]);(0,a.useEffect)((()=>{d&&n&&!h.current&&(h.current=!0,(async()=>{console.log("Mock Firebase Messaging Initialized."),Promise.resolve("mock-firebase-token-12345")})())}),[d,n]);const{data:b,isLoading:M,error:N}=(0,o.I)({queryKey:["totalInvestment",null===n||void 0===n?void 0:n.id],queryFn:C,enabled:!!n,...j}),{data:R,isLoading:q,error:z}=(0,o.I)({queryKey:["totalProfit",null===n||void 0===n?void 0:n.id],queryFn:S,enabled:!!n,...j}),{data:P,isLoading:B}=(0,o.I)({queryKey:["monthlyInvestment",null===n||void 0===n?void 0:n.id],queryFn:L,enabled:!!n,...j}),{data:K,isLoading:E}=(0,o.I)({queryKey:["yearlyProfit",null===n||void 0===n?void 0:n.id],queryFn:D,enabled:!!n,...j}),{data:U,isLoading:W}=(0,o.I)({queryKey:["portfolioPerformance",null===n||void 0===n?void 0:n.id],queryFn:w,enabled:!!n,...j}),{data:H,isLoading:O}=(0,o.I)({queryKey:["recentTransactions",null===n||void 0===n?void 0:n.id],queryFn:T,enabled:!!n,...j}),G=(0,a.useMemo)((()=>((e,t)=>{var r;return(null===e||void 0===e||null===(r=e.monthlyData)||void 0===r?void 0:r.length)>0?e.monthlyData.map((e=>({name:e.month,investment:e.amount}))):F((null===e||void 0===e?void 0:e.totalInvestment)||t,["Jan","Feb","Mar","Apr","May","Jun"],"investment","name")})(P,null===b||void 0===b?void 0:b.totalInvestment)),[P,b]),$=(0,a.useMemo)((()=>((e,t)=>{var r;return(null===e||void 0===e||null===(r=e.yearlyData)||void 0===r?void 0:r.length)>0?e.yearlyData.map((e=>({year:e.year,profit:e.profit}))):F((null===e||void 0===e?void 0:e.totalProfit)||t,["2022","2023","2024"],"profit","year")})(K,null===R||void 0===R?void 0:R.totalProfitOrLoss)),[K,R]),J=(0,a.useMemo)((()=>((null===b||void 0===b?void 0:b.totalInvestment)||0)+((null===R||void 0===R?void 0:R.totalProfitOrLoss)||0)),[b,R]),Z=(0,a.useMemo)((()=>{var e;return(null===H||void 0===H||null===(e=H.transactions)||void 0===e?void 0:e.length)||0}),[H]),V=(0,a.useMemo)((()=>(0,g.jsx)(k,{data:G,dataKey:"investment",stroke:"#8a7cff",name:"investment",yAxisFormatter:p})),[G,p]),Y=(0,a.useMemo)((()=>(0,g.jsx)(k,{data:$,dataKey:"profit",stroke:"#00b929",name:"profit",yAxisFormatter:p})),[$,p]);return(0,a.useEffect)((()=>{c||d||m.current||(m.current=!0,u("/login",{replace:!0}))}),[d,c,u]),c?(0,g.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"#161921"},children:(0,g.jsx)(l.A,{})}):d&&n?(0,g.jsxs)("div",{style:{...x.dashboardUser,...x.themeDark},children:[(0,g.jsx)(v,{setIsAuthenticated:r}),(0,g.jsxs)("main",{style:x.dashboardMainContent,children:[(0,g.jsxs)("header",{style:x.dashboardContentHeader,children:[(0,g.jsx)("h2",{style:x.headerTitle,children:"Dashboard"}),(0,g.jsxs)("p",{style:x.headerSubtitle,children:["Welcome back, ",(null===n||void 0===n?void 0:n.displayName)||(null===n||void 0===n?void 0:n.name)||"User","!"]}),(0,g.jsxs)("div",{style:x.headerStats,children:[(0,g.jsxs)("span",{children:["Portfolio Value: ",y(J)]}),(0,g.jsxs)("span",{children:["Recent Transactions: ",Z]})]})]}),(0,g.jsxs)("div",{style:x.dashboardGridCards,children:[(0,g.jsx)(I,{title:"Total Investment",amount:y(null===b||void 0===b?void 0:b.totalInvestment),isLoading:M,error:N,chart:V,dataSource:B?"Loading...":"Monthly Breakdown"}),(0,g.jsx)(I,{title:"Total Profit",amount:y(null===R||void 0===R?void 0:R.totalProfitOrLoss),isLoading:q,error:z,chart:Y,dataSource:E?"Loading...":"Yearly Breakdown",changeText:"Represents your total earnings."}),(0,g.jsxs)(i.A,{component:"article",style:x.dashboardCard,children:[(0,g.jsx)("div",{style:x.cardHeader,children:(0,g.jsx)("h3",{style:x.cardTitle,children:"Recent Activity"})}),(0,g.jsxs)("div",{style:x.cardBody,children:[(0,g.jsx)("p",{style:x.amount,children:Z}),(0,g.jsx)("p",{style:x.change,children:"Recent transactions"}),O?(0,g.jsx)("p",{children:"Loading..."}):null===H||void 0===H||null===(t=H.transactions)||void 0===t?void 0:t.slice(0,3).map(((e,t)=>(0,g.jsxs)("div",{style:x.transactionItem,children:[(0,g.jsx)("span",{children:e.type}),(0,g.jsx)("span",{children:y(e.amount)})]},e.id||t)))]})]})]})]})]}):null}}}]);
//# sourceMappingURL=677.23101c21.chunk.js.map