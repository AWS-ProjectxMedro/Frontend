"use strict";(self.webpackChunkthecapitaltree=self.webpackChunkthecapitaltree||[]).push([[736],{2342:()=>{},3736:(e,a,s)=>{s.r(a),s.d(a,{default:()=>u});var t=s(5043),r=s(6213),l=s(7488),n=(s(2342),s(579));const i="http://43.204.120.102:3308",o={GET_ALL:"/api/withdrawals",APPROVE:e=>`/api/withdrawals/${e}/approve`,REJECT:e=>`/api/withdrawals/${e}/reject`},d=r.A.create({baseURL:i});d.interceptors.request.use((e=>{const a=localStorage.getItem("authToken");return a&&(e.headers.Authorization=`Bearer ${a}`),e}),(e=>Promise.reject(e)));const c=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"INR";return"number"!==typeof e?"N/A":e.toLocaleString("en-IN",{style:"currency",currency:a})},m=(e,a)=>{if(console.log(`\ud83d\udd0d Processing user data for withdrawal ${a}:`,e),!e||null===e||void 0===e)return console.warn(`\u26a0\ufe0f No user data for withdrawal ${a}`),(0,n.jsxs)("div",{className:"user-info",children:[(0,n.jsx)("span",{className:"user-name",style:{color:"#ff6b6b"},children:"Unknown User"}),(0,n.jsx)("span",{className:"user-email",style:{color:"#999"},children:"No email provided"})]});console.log(`\ud83d\udccb User object keys for withdrawal ${a}:`,Object.keys(e)),console.log("\ud83d\udcdd User values:",e);const s=Object.keys(e);console.log("\ud83d\udd0d ACTUAL USER FIELDS:"),s.forEach((a=>{console.log(`  ${a}: "${e[a]}"`)}));let t="Unknown User",r="No email provided";return e.name&&e.name.trim()?t=e.name.trim():e.fullName&&e.fullName.trim()?t=e.fullName.trim():e.username&&e.username.trim()?t=e.username.trim():e.displayName&&e.displayName.trim()?t=e.displayName.trim():e.firstName&&e.lastName?t=`${e.firstName} ${e.lastName}`.trim():e.firstName?t=e.firstName.trim():e.full_name&&e.full_name.trim()?t=e.full_name.trim():e.first_name&&e.last_name?t=`${e.first_name} ${e.last_name}`.trim():e.first_name&&(t=e.first_name.trim()),e.email&&e.email.trim()?r=e.email.trim():e.userEmail&&e.userEmail.trim()?r=e.userEmail.trim():e.emailAddress&&e.emailAddress.trim()?r=e.emailAddress.trim():e.mail&&e.mail.trim()?r=e.mail.trim():e.email_address&&e.email_address.trim()&&(r=e.email_address.trim()),console.log(`\u2705 Final user info for withdrawal ${a}:`,{userName:t,userEmail:r}),(0,n.jsxs)("div",{className:"user-info",children:[(0,n.jsx)("span",{className:"user-name",children:t}),(0,n.jsx)("span",{className:"user-email",children:r})]})},u=()=>{const[e,a]=(0,t.useState)([]),[s,r]=(0,t.useState)(!0),[i,u]=(0,t.useState)(null),[h,p]=(0,t.useState)(null);(0,t.useEffect)((()=>{(async()=>{r(!0),u(null);try{console.log("\ud83c\udf10 Fetching withdrawals from:",o.GET_ALL);const e=await d.get(o.GET_ALL);if(console.log("\u2705 API Response:",e.data),!Array.isArray(e.data))throw new Error("Expected array but received "+typeof e.data);e.data.length>0&&console.log("\ud83d\udccb First item structure:",e.data[0]),a(e.data)}catch(e){console.error("\u274c Error fetching withdrawals:",e),u(`Failed to fetch withdrawal requests: ${e.message}`)}finally{r(!1)}})()}),[]);const w=(s,t)=>{const r=`Are you sure you want to ${"approve"===t?"approve":"reject"} withdrawal request #${s}?`,i=i=>{let{closeToast:c}=i;return(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{style:{margin:"0 0 15px 0"},children:r}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[(0,n.jsx)("button",{className:"btn btn-toast-cancel",onClick:c,children:"Cancel"}),(0,n.jsx)("button",{className:"btn btn-toast-confirm",onClick:()=>{(async()=>{p(s);const r=[...e],i="approve"===t?"approved":"rejected";a((e=>e.map((e=>e.id===s?{...e,status:i}:e))));try{const e="approve"===t?o.APPROVE(s):o.REJECT(s);console.log(`\ud83d\udd04 ${t.toUpperCase()}ING withdrawal ${s} at:`,e);const r={adminNote:`${i.charAt(0).toUpperCase()+i.slice(1)} by admin on ${(new Date).toLocaleString()}`},n=await d.post(e,r);console.log(`\u2705 Successfully ${t}ed withdrawal ${s}:`,n.data),n.data&&n.data.withdrawal&&a((e=>e.map((e=>e.id===s?{...e,...n.data.withdrawal}:e)))),l.oR.success(`\u2705 Withdrawal request #${s} has been ${i} successfully!`)}catch(u){var c,m;console.error(`\u274c Error ${t}ing withdrawal:`,u),a(r);const e=(null===(c=u.response)||void 0===c||null===(m=c.data)||void 0===m?void 0:m.message)||u.message||"Unknown error occurred";l.oR.error((0,n.jsxs)("div",{children:[(0,n.jsxs)("b",{children:["Failed to ",t," withdrawal #",s,"."]}),(0,n.jsx)("br",{}),(0,n.jsxs)("small",{children:["Error: ",e]})]}))}finally{p(null)}})(),c()},children:"Confirm"})]})]})};(0,l.oR)((0,n.jsx)(i,{}),{position:"top-center",autoClose:!1,closeOnClick:!1,draggable:!1,toastId:`confirm-action-${s}`})};return(0,n.jsxs)("div",{className:"withdrawal-page",children:[(0,n.jsx)(l.N9,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"colored"}),(0,n.jsxs)("header",{className:"page-header",children:[(0,n.jsx)("h2",{children:"Manage Withdrawals"}),(0,n.jsx)("p",{children:"Review and process pending withdrawal requests."})]}),s?(0,n.jsx)("div",{className:"loading-message",children:"Loading withdrawal requests..."}):i?(0,n.jsxs)("div",{className:"error-message",children:[(0,n.jsx)("p",{children:i}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"btn btn-retry",children:"Retry"})]}):0===e.length?(0,n.jsx)("div",{className:"no-data-message",children:"No withdrawal requests found."}):(0,n.jsx)("div",{className:"table-container",children:(0,n.jsxs)("table",{className:"withdrawal-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"User"}),(0,n.jsx)("th",{children:"Amount"}),(0,n.jsx)("th",{children:"Date"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:e.map(((e,a)=>{const s=h===e.id;let t=null;if(e.User)t=e.User.dataValues||e.User;else if(e.user)t=e.user.dataValues||e.user;else{const a=Object.keys(e).find((e=>e.toLowerCase().includes("user")));a&&(t=e[a])}return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{"data-label":"User",children:m(t,e.id)}),(0,n.jsx)("td",{"data-label":"Amount",className:"amount-cell",children:c(e.amount)}),(0,n.jsx)("td",{"data-label":"Date",children:e.createdAt?(r=e.createdAt,new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})):"No date"}),(0,n.jsx)("td",{"data-label":"Status",children:(0,n.jsx)("span",{className:`status-badge status-${(e.status||"unknown").toLowerCase()}`,children:e.status||"Unknown"})}),(0,n.jsx)("td",{"data-label":"Actions",children:(0,n.jsxs)("div",{className:"action-buttons",children:[("Pending"===e.status||"pending"===e.status)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>w(e.id,"approve"),className:"btn btn-approve",disabled:s,title:`Approve withdrawal request #${e.id}`,children:s?"\u23f3 Processing...":"\u2705 Approve"}),(0,n.jsx)("button",{onClick:()=>w(e.id,"reject"),className:"btn btn-reject",disabled:s,title:`Reject withdrawal request #${e.id}`,children:s?"\u23f3 Processing...":"\u274c Reject"})]}),("approved"===e.status||"Approved"===e.status)&&(0,n.jsx)("span",{className:"status-text approved-text",children:"\u2705 Approved"}),("rejected"===e.status||"Rejected"===e.status)&&(0,n.jsx)("span",{className:"status-text rejected-text",children:"\u274c Rejected"})]})})]},e.id||`withdrawal-${a}`);var r}))})]})})]})}}}]);
//# sourceMappingURL=736.64c75b50.chunk.js.map